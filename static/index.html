<html>
<head>
<script type="text/javascript" src='/static/js/jquery-1.7.1.min.js'></script>
<script src="/static/js/jquery.tmpl.min.js" type="text/javascript"></script>
<script src="/latest_event/" type="text/javascript"></script>

<script type="text/javascript">
$(document).ready(function() {
    // is connected???
    
    function caller_controller(data) {
        if (data.event == 'ENTERQUEUE') {
            $('#callers').append('<div style="background-color:red;" class="caller_' + data.callid + '">' + data.data + '</div>');
            console.log('add caller ' + data.callid);
        }

        if (   data.event == 'COMPLETEAGENT'
            || data.event == 'COMPLETECALLER'
            || data.event == 'TRANSFER'
            || data.event == 'ABANDON')
        {
            $('.caller_' + data.callid).remove();
        }

        if (data.event == 'CONNECT') {
            $('.caller_' + data.callid).css('background-color', 'green');
        }
    }

    function agent_controller(data) {
    }

    function layout_controller(data) {
        $('#test').append(data.time + ' ' + data.event + ' ' + data.callid + '\n');
    }

    var controllers = [
        caller_controller,
        agent_controller,
        layout_controller
    ];

    function poll(){
        that = this
        $.ajax({
    	    url: "/getevents/" + last_event, 

            success: function(data){
                for (i = 0; i <= controllers.length; i++) {
                    that.controllers[i](data);
                }
//                var array;
//
//                //everything below here works fine regardless of the two above cases
//                array['something'] = ‘yay’;
//                array['somethingelse'] = ‘more’;
//
//                for ( keyVar in array ) {
//                alert(array[keyVar]);
//                }
                last_event = data.id;
    	    },

    	    error: function(error){
                console.log(error);
    	    }, 

    	    dataType: "json",
    	    complete: poll, 
    	    timeout: 60000
    	});
    }
    
    poll();
});

</script>

</head>
<body>
<textarea cols="80" rows="10" id="test"></textarea>

<div id="callers"></div>
</body>
</html>
